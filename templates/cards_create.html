{% extends "base.html" %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // milestone counter code
    const textarea = document.getElementById('milestones');
    const counter = document.getElementById('number_of_milestones');
    
    function updateCount() {
        const lines = textarea.value.trim().split('\n').filter(line => line.length > 0);
        counter.textContent = `Anzahl Meilensteine: ${lines.length}`;
    }
    
    textarea.addEventListener('input', updateCount);
    updateCount();

    // New code for copying student names
    document.getElementById('copy_names').addEventListener('click', function() {
        const selectedProject = document.getElementById('project_select').value;
        const studentsList = JSON.parse(document.getElementById('project_data').textContent);
        const studentNames = studentsList[selectedProject].join('\n');
        document.getElementById('student_names').value = studentNames;
    });
});
</script>

<!-- Add hidden element with project data -->
<script type="application/json" id="project_data">
    {{project_students|tojson}}
</script>
{% endblock %}

{% block title %} 
Projekt erstellen
{% endblock %}

{% block heading %} 
Projekt erstellen
{% endblock %}

{% block body %}

<form action="{{url_for('cards_create')}}" method="POST">
    <input name="project_name" placeholder="Projektname" required
        title="Projektname (kein / oder : im Titel)"
        pattern="[^/:]+">
    Meilensteine (ein Meilenstein pro Zeile)
    <textarea id="milestones" name="milestones">
Meilenstein 1
Meilenstein 2</textarea>

    <div id="number_of_milestones">        
    </div>
    <hr>

    <!-- Add project selection -->
    <details>
        <summary>Namen aus anderem Projekt 端bernehmen</summary>
        <select id="project_select">
            {% for project in project_students.keys()|sort %}
            <option value="{{project}}">{{project}}</option>
            {% endfor %}
        </select>
        <button type="button" id="copy_names">Namen 端bernehmen</button>
    </details>

    Sch端lerinnen und Sch端ler (ein Name pro Zeile)
    <textarea id="student_names" name="student_names">
Max Muster
Moni Muster</textarea>

    <details>
        <summary>Zugriff verwalten</summary>
        <p>
        Nutzer mit Zugriff:<br>
        {% for user in users %}
            <input type="checkbox" name="users" value="{{ user.uid }}" 
                {% if current_user.dbu == user %}            
                checked
                {% endif %}> {{ user.uid }} <br>
        {% endfor %}
        </p>
    </details>
    <input type="submit" value="erstellen">
</form>

{% endblock %}
